# How to use, this is useless without downloading istioctl binaries and files
# 1. curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.22.3 TARGET_ARCH=x86_64 sh -
# 2. cd istio-1.22.3/
# 3. export PATH=$PWD/bin:$PATH
# 4. ln -s ABSOLUTE_PATH_TO_THIS_YAML_FILE manifests/profile/NAME_OF_THIS_FILE
# 5. istioctl install --set profile=manifests/profiles/NAME_OF_THIS_FILE
#
# If you want to cleanup:
# 1. istioctl uninstall --purge
#

apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  namespace: istio-system
spec:
  hub: docker.io/istio
  tag: 1.22.3

  # Turn on default components: base, pilot, and ingress gateway
  components:
    base:
      enabled: true
    pilot:
      enabled: true
    # Istio Gateway feature
    ingressGateways:
    - name: istio-ingressgateway-profile
      enabled: true
      k8s:
        serviceAnnotations:
          metallb.universe.tf/address-pool:  ipprofilemly
    - name: istio-ingressgateway-cv
      enabled: true
      k8s:
        serviceAnnotations:
          metallb.universe.tf/address-pool:  ipcvmly
    egressGateways:
    - name: istio-egressgateway-profile
      enabled: false
    - name: istio-egressgateway-cv
      enabled: false

  # Most default values come from the helm chart's values.yaml
  # Below are the things that differ
  values:
    defaultRevision: ""
    global:
      istioNamespace: istio-system
      configValidation: true
    gateways:
      istio-egressgateway: {}
      istio-egressgateway: {}
